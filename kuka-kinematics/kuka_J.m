function J = kuka_J(q)
%
% Computes the geometric Jacobian for the Kuka LWR
%
% function M = kuka_J(q)
%
% input:
%       q     dim 7x1     joint positions
%
% output:
%       J     dim 7x6     geometric Jacobian
%
% G. Antonelli, Sistemi Robotici, fall 2012

d0=0.3105;
d3=0.40; 
d5=0.39; 
d7=0.078; 
db=0; 


q1=q(1);
q2=q(2);
q3=q(3);
q4=q(4);
q5=q(5);
q6=q(6);
%q7=q(7);

s1 = sin(q1);
c1 = cos(q1);
s2 = sin(q2);
c2 = cos(q2);
s3 = sin(q3);
c3 = cos(q3);
s4 = sin(q4);
c4 = cos(q4);
s5 = sin(q5);
c5 = cos(q5);
s6 = sin(q6);
c6 = cos(q6);
%s7 = sin(q7);
%c7 = cos(q7);

J =[  d7*s6*c5*c4*s1*c2*c3+d7*s6*c5*c4*c1*s3+d7*s6*c5*s1*s2*s4-d7*s6*s5*s1*c2*s3+d7*s6*s5*c1*c3-d7*c6*s4*s1*c2*c3-d7*c6*s4*c1*s3+d7*c6*s1*s2*c4-d5*s4*s1*c2*c3-d5*s4*c1*s3+d5*s1*s2*c4+s1*s2*d3,...
    -c1*(-d7*s6*c5*s2*c3*c4+d7*s6*c5*c2*s4+d7*s6*s2*s3*s5+d7*c6*s2*c3*s4+d7*c6*c2*c4+d5*s2*c3*s4+d5*c2*c4+c2*d3),...
    d7*s6*c5*c4*s1*c3-d7*s6*s5*s1*s3-d7*c6*s4*s1*c3-d5*s4*s1*c3+c2*d7*s6*c5*c4*c1*s3+c2*d7*s6*s5*c1*c3-c2*d7*c6*s4*c1*s3-c2*d5*s4*c1*s3,...
    c1*c3*d5*c2*c4-s2*d7*s6*c5*c4*c1-s1*s3*d7*s6*c5*s4+s2*d7*c6*s4*c1-s1*s3*d7*c6*c4+s2*d5*s4*c1-s1*s3*d5*c4+c1*c3*d7*s6*c5*c2*s4+c1*c3*d7*c6*c2*c4,...
    s6*(c1*s3*c5*c2+s4*c1*s2*s5-c4*s5*s1*s3+c3*c5*s1+c2*c4*s5*c1*c3)*d7,...
    -d7*(-c4*c1*s6*s2-s1*s4*s6*s3-s5*s1*c6*c3+c2*s4*s6*c1*c3-s5*c2*c6*c1*s3+s2*c5*c6*s4*c1+c5*c1*c3*c6*c2*c4-c5*s1*s3*c6*c4),...
    0;
 -d7*s6*c5*c4*c1*c2*c3+d7*s6*c5*c4*s1*s3-d7*s6*c5*c1*s2*s4+d7*s6*s5*c1*c2*s3+d7*s6*s5*s1*c3+d7*c6*s4*c1*c2*c3-d7*c6*s4*s1*s3-d7*c6*c1*s2*c4+d5*s4*c1*c2*c3-d5*s4*s1*s3-d5*c1*s2*c4-c1*s2*d3,...
 -s1*(-d7*s6*c5*s2*c3*c4+d7*s6*c5*c2*s4+d7*s6*s2*s3*s5+d7*c6*s2*c3*s4+d7*c6*c2*c4+d5*s2*c3*s4+d5*c2*c4+c2*d3),...
 c2*d7*s6*c5*c4*s1*s3+c2*d7*s6*s5*s1*c3-c2*d7*c6*s4*s1*s3-c2*d5*s4*s1*s3-d7*s6*c5*c4*c1*c3+d7*s6*s5*c1*s3+d7*c6*s4*c1*c3+d5*s4*c1*c3,...
 s2*d7*c6*s4*s1-s2*d7*s6*c5*c4*s1+c1*s3*d7*s6*c5*s4+c1*s3*d7*c6*c4+s2*d5*s4*s1+c1*s3*d5*c4+s1*c3*d7*s6*c5*c2*s4+s1*c3*d7*c6*c2*c4+s1*c3*d5*c2*c4,...
 s6*(s5*c4*s1*c2*c3+s5*c4*c1*s3+s5*s1*s2*s4+c5*s1*c2*s3-c5*c1*c3)*d7,...
 -d7*(c3*c5*s1*c6*c2*c4+c1*s3*c5*c6*c4+c2*s4*s6*s1*c3-s5*c2*c6*s1*s3+s2*c5*c6*s4*s1+s4*c1*s6*s3+c1*s5*c6*c3-c4*s1*s6*s2),...
 0;
 0,...
 -d7*s6*c5*c4*c2*c3-d7*s6*c5*s2*s4+d7*s6*s5*c2*s3+d7*c6*s4*c2*c3-d7*c6*s2*c4+d5*s4*c2*c3-d5*s2*c4-s2*d3,...
 s2*(d7*s6*c5*c4*s3+d7*s6*s5*c3-d7*c6*s4*s3-d5*s4*s3),...
 -c2*d7*c6*s4-c2*d5*s4+c3*d7*s6*c5*s2*s4+c3*d7*c6*s2*c4+c3*d5*s2*c4+c2*d7*s6*c5*c4,...
 -s6*(-s2*s3*c5+s5*c2*s4-s5*s2*c3*c4)*d7,...
 -d7*(-c5*c2*c6*s4+c4*s6*c2+c3*c5*c6*s2*c4+s2*s4*s6*c3-s5*s2*c6*s3),...
 0;
 0,...
 s1,...
 -c1*s2,...
 -c1*c2*s3-s1*c3,...
 s4*c1*c2*c3-s4*s1*s3-c1*s2*c4,...
 c1*s3*c5*c2+s4*c1*s2*s5-c4*s5*s1*s3+c3*c5*s1+c2*c4*s5*c1*c3,...
 -s6*c5*c4*c1*c2*c3+s6*c5*c4*s1*s3-s6*c5*c1*s2*s4+s6*s5*c1*c2*s3+s6*s5*s1*c3+c6*s4*c1*c2*c3-c6*s4*s1*s3-c6*c1*s2*c4;
 0,...
 -c1,...
 -s1*s2,...
 -s1*c2*s3+c1*c3,...
 s4*s1*c2*c3+s4*c1*s3-s1*s2*c4,...
 s5*c4*s1*c2*c3+s5*c4*c1*s3+s5*s1*s2*s4+c5*s1*c2*s3-c5*c1*c3,...
 -s6*c5*c4*s1*c2*c3-s6*c5*c4*c1*s3-s6*c5*s1*s2*s4+s6*s5*s1*c2*s3-s6*s5*c1*c3+c6*s4*s1*c2*c3+c6*s4*c1*s3-c6*s1*s2*c4;
 1,...
 0,...
 c2,...
 -s2*s3,...
 s2*c3*s4+c2*c4,...
 s5*s2*c3*c4-s5*c2*s4+s2*s3*c5,...
 -s6*c5*s2*c3*c4+s6*c5*c2*s4+s6*s2*s3*s5+c6*s2*c3*s4+c6*c2*c4];

 
 
 
